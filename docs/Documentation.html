<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Documentation &mdash; Phybers 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="References" href="References.html" />
    <link rel="prev" title="Examples and Tutorial Guide" href="Examples%20and%20Tutorial%20Guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Phybers
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Requirements%20and%20Dependencies.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples%20and%20Tutorial%20Guide.html">Examples and Tutorial Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#segment">Segment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fiberseg-description">FiberSeg Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#atlases-download">Atlases Download</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.segment.fiberseg"><code class="docutils literal notranslate"><span class="pre">fiberseg()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clustering">Clustering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hclust-description">HClust Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.clustering.hclust"><code class="docutils literal notranslate"><span class="pre">hclust()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ffclust-description">FFClust Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.clustering.ffclust"><code class="docutils literal notranslate"><span class="pre">ffclust()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#utils">Utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deformation-description">Deformation Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.utils.deform"><code class="docutils literal notranslate"><span class="pre">deform()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sampling-description">Sampling Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.utils.sampling"><code class="docutils literal notranslate"><span class="pre">sampling()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#intersection-description">Intersection Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.utils.intersection"><code class="docutils literal notranslate"><span class="pre">intersection()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#postprocessing-description">Postprocessing Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phybers.utils.postprocessing"><code class="docutils literal notranslate"><span class="pre">postprocessing()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualization">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#phybers.fibervis.start_fibervis"><code class="docutils literal notranslate"><span class="pre">start_fibervis()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="References.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phybers</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Documentation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="documentation">
<span id="doc-phybers"></span><h1>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading"></a></h1>
<section id="segment">
<span id="segment-doc"></span><h2>Segment<a class="headerlink" href="#segment" title="Permalink to this heading"></a></h2>
<p>This module incorporates a white matter fiber bundle segmentation algorithm, called FiberSeg, which is based on a multi-subject atlas. The algorithm is cited from <span id="id1">[<a class="reference internal" href="References.html#id3" title="P. Guevara, D. Duclap, C. Poupon, L. Marrakchi-Kacem, P. Fillard, D. Le Bihan, M. Leboyer, J. Houenou, and J. F. Mangin. Automatic fiber bundle segmentation in massive tractography datasets using a multi-subject bundle atlas. Neuroimage, 61(4):1083-99, 2012. doi:10.1016/j.neuroimage.2012.02.071.">3</a>, <a class="reference internal" href="References.html#id4" title="Nicole Labra, Pamela Guevara, Delphine Duclap, Josselin Houenou, Cyril Poupon, Jean-François Mangin, and Miguel Figueroa. Fast automatic segmentation of white matter streamlines based on a multi-subject bundle atlas. Neuroinformatics, 15(1):71-86, 2017. doi:10.1007/s12021-016-9316-7.">5</a>, <a class="reference internal" href="References.html#id8" title="Andrea Vázquez, Narciso López-López, Nicole Labra, Miguel Figueroa, Cyril Poupon, Jean-François Mangin, Cecilia Hernández, and Pamela Guevara. Parallel optimization of fiber bundle segmentation for massive tractography datasets. In 2019 IEEE 16th International Symposium on Biomedical Imaging (ISBI 2019), 178-181. IEEE, 2019. doi:10.1109/ISBI.2019.8759208.">6</a>]</span>.</p>
<span class="target" id="module-phybers.segment"></span><section id="fiberseg-description">
<h3>FiberSeg Description<a class="headerlink" href="#fiberseg-description" title="Permalink to this heading"></a></h3>
<p>The FiberSeg uses as a measure of similarity between pairs of fibers the maximum Euclidean distance between corresponding points ( <span class="math notranslate nohighlight">\(d_{ME}\)</span>), defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
\label{eq:ecua1}
d_{ME}(A,B) = \min(\max_{i}(|a_{i}-b_{i}|),\max_{i}(|a_{i}-b_{N_{p}-i}|)) \quad \qquad [1]
\end{equation}\]</div>
<p>Where <span class="math notranslate nohighlight">\(a_{i}\)</span> and <span class="math notranslate nohighlight">\(b_{i}\)</span> represent the 3D coordinates of the points in fibers A and B, respectively, both having an equal number of points (<span class="math notranslate nohighlight">\(N_{p}\)</span>) and in direct order.
This implies that the points of fiber A are sequentially traversed as <span class="math notranslate nohighlight">\(a_{i}\)</span> = [<span class="math notranslate nohighlight">\(a_{1}\)</span>, <span class="math notranslate nohighlight">\(a_{2}\)</span>, …, <span class="math notranslate nohighlight">\(a_{N_{p}}\)</span>],
and those of B are similarly defined: <span class="math notranslate nohighlight">\(b_{i}\)</span> = [<span class="math notranslate nohighlight">\(b_{1}\)</span>, <span class="math notranslate nohighlight">\(b_{2}\)</span>, …, <span class="math notranslate nohighlight">\(b_{N_{p}}\)</span>].
Therefore, the reverse order of fiber B is expressed as  <span class="math notranslate nohighlight">\(b_{N_{p-i}}\)</span> = [ <span class="math notranslate nohighlight">\(b_{N_{p}}\)</span>, <span class="math notranslate nohighlight">\(b_{N_{p-1}}\)</span>, …, <span class="math notranslate nohighlight">\(b_{1}\)</span>].</p>
<p>It aims to classify the subject fibers according to a multi-subject bundle atlas. The bundle atlas consists of a set of representative bundles and an information file.
The fibers of the atlas bundles are called centroids. The fibers of each subject are classified using a maximum <span class="math notranslate nohighlight">\(d_{ME}\)</span> distance threshold for each bundle between the subject’s fibers and the atlas centroids.
The fibers are labeled with the closest atlas bundle, given that the distance is smaller than the distance threshold.</p>
</section>
<section id="atlases-download">
<span id="id2"></span><h3>Atlases Download<a class="headerlink" href="#atlases-download" title="Permalink to this heading"></a></h3>
<p>We provide one atlas of deep white matter (DWM) bundles <span id="id3">[<a class="reference internal" href="References.html#id3" title="P. Guevara, D. Duclap, C. Poupon, L. Marrakchi-Kacem, P. Fillard, D. Le Bihan, M. Leboyer, J. Houenou, and J. F. Mangin. Automatic fiber bundle segmentation in massive tractography datasets using a multi-subject bundle atlas. Neuroimage, 61(4):1083-99, 2012. doi:10.1016/j.neuroimage.2012.02.071.">3</a>]</span> and two atlases of superficial white matter (SWM) bundles, <span id="id4">[<a class="reference internal" href="References.html#id6" title="Claudio Román, Miguel Guevara, Ronald Valenzuela, Miguel Figueroa, Josselin Houenou, Delphine Duclap, Cyril Poupon, Jean-François Mangin, and Pamela Guevara. Clustering of whole-brain white matter short association bundles using hardi data. Frontiers in Neuroinformatics, 11:73, 2017 2017. doi:10.3389/fninf.2017.00073.">4</a>]</span> and <span id="id5">[<a class="reference internal" href="References.html#id7" title="Claudio Román, Cecilia Hernández, Miguel Figueroa, Josselin Houenou, Cyril Poupon, Jean-François Mangin, and Pamela Guevara. Superficial white matter bundle atlas based on hierarchical fiber clustering over probabilistic tractography data. NeuroImage, 262:119550, 2022. doi:10.1016/j.neuroimage.2022.119550.">7</a>]</span>.
The following links provide access to these three atlases:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://www.dropbox.com/scl/fo/vy3j1bi56w07arzqnn8gc/h?rlkey=ngppw0xu4a5rbmx6sh0rtyg1o&amp;dl=1">Download DWM Bundles Atlas (Pamela Guevara 2012)</a></p></li>
<li><p><a class="reference external" href="https://www.dropbox.com/scl/fo/adjz3yx0pkw6nyekrpyta/h?rlkey=qpzulmnm86kn3a7zu02693t4z&amp;dl=1">Download SWM Bundles Atlas (Claudio Roman 2017)</a></p></li>
<li><p><a class="reference external" href="https://www.dropbox.com/scl/fo/hperwxwe86ai334x41ee5/h?rlkey=sfgz7v34sls40x3wgntmnpa9y&amp;dl=1">Download SWM Bundles Atlas (Claudio Roman 2022)</a></p></li>
</ol>
<p>In addition to these atlases, we have tested our algorithm with the atlas <span id="id6">[<a class="reference internal" href="References.html#id10" title="Fan Zhang, Ye Wu, Isaiah Norton, Laura Rigolo, Yogesh Rathi, Nikos Makris, and Lauren J. O'Donnell. An anatomically curated fiber clustering white matter atlas for consistent white matter tract parcellation across the lifespan. NeuroImage, 179:429-447, 2018. doi:10.1016/j.neuroimage.2018.06.027.">8</a>]</span>, whi  ch contains both  DWM and SWM bundle.
If you need this atlas in data <em>‘.bundle’</em> format, feel free to contact us via email.</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.segment.fiberseg">
<span class="sig-prename descclassname"><span class="pre">phybers.segment.</span></span><span class="sig-name descname"><span class="pre">fiberseg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subj_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atlas_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atlas_info</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_out</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/phybers/segment/segment.html#fiberseg"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.segment.fiberseg" title="Permalink to this definition"></a></dt>
<dd><p>White matter fiber bundle segmentation algorithm based on a multi-subject atlas.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_in</strong> (<em>str</em>) – Tractography data file in <em>‘.bundles’</em> format.</p></li>
<li><p><strong>subj_name</strong> (<em>str</em>) – Subject name, used to label the results.</p></li>
<li><p><strong>atlas_dir</strong> (<em>str</em>) – Bundle atlas, with bundles in separated files, sampled at 21 equidistant points. The bundle atlases provided are in same folders.</p></li>
<li><p><strong>atlas_info</strong> (<em>str</em>) – Text file associated to the used atlas, that stores information needed to apply the segmentation algorithm, i.e., a list of the atlas fascicles, containing the name, the segmentation
threshold (in <em>mm</em>) and the size of each fascicle. Note that the segmentation threshold can be adjusted depending on the database to be used.</p></li>
<li><p><strong>dir_out</strong> (<em>str</em>) – Directory name to store all the results generated by the algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function generates the following files in the specified directory:</p>
<dl class="simple">
<dt>final_bundles<span class="classifier">bundles files</span></dt><dd><p>Directory contains all atlas fascicles extracted from the subject, saved as separate files in the ‘.bundles’ format.
Each file’s name is composed of the atlas label followed by the subject’s ID</p>
</dd>
<dt>centroids<span class="classifier">bundles file</span></dt><dd><p>Directory that contains the centroid for each fascicle segmented in same <em>‘.bundles’</em> files.</p>
</dd>
<dt>bundles_id<span class="classifier">text file</span></dt><dd><p>Text file containing the indexes of the fibers that were segmented by each fascicle of the atlas.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To use the <cite>fiberseg()</cite> function, you need to download the tractography data from the <a class="reference external" href="https://www.dropbox.com/sh/tj67742sxvmqfg1/AAD_J41rw4E70OVFayAy18T6a?dl=1">link fiberseg</a> .
Then, you can run the following code in a Python terminal:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.segment</span> <span class="kn">import</span> <span class="n">fiberseg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_in</span> <span class="o">=</span> <span class="s1">&#39;path_to_tractography_data.bundles&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subj_name</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atlas_dir</span> <span class="o">=</span> <span class="s1">&#39;path_to_atlas/bundles&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atlas_info</span> <span class="o">=</span> <span class="s1">&#39;path_to_atlas/atlas_info.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dir_out</span> <span class="o">=</span> <span class="s1">&#39;path_to_output_directory&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fiberseg</span><span class="p">(</span><span class="n">file_in</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">atlas_dir</span><span class="p">,</span> <span class="n">atlas_info</span><span class="p">,</span> <span class="n">dir_out</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: Make sure to replace ‘path_to_tractography_data’, ‘path_to_atlas’, and ‘path_to_output_directory’ with the actual paths to your data and directories.</p>
</dd></dl>

</section>
</section>
<section id="clustering">
<span id="clustering-doc"></span><h2>Clustering<a class="headerlink" href="#clustering" title="Permalink to this heading"></a></h2>
<p>The module comprises two algorithms for clustering cerebral fibers, HClust (Clustering Hierarchical, <span id="id7">[<a class="reference internal" href="References.html#id6" title="Claudio Román, Miguel Guevara, Ronald Valenzuela, Miguel Figueroa, Josselin Houenou, Delphine Duclap, Cyril Poupon, Jean-François Mangin, and Pamela Guevara. Clustering of whole-brain white matter short association bundles using hardi data. Frontiers in Neuroinformatics, 11:73, 2017 2017. doi:10.3389/fninf.2017.00073.">4</a>, <a class="reference internal" href="References.html#id7" title="Claudio Román, Cecilia Hernández, Miguel Figueroa, Josselin Houenou, Cyril Poupon, Jean-François Mangin, and Pamela Guevara. Superficial white matter bundle atlas based on hierarchical fiber clustering over probabilistic tractography data. NeuroImage, 262:119550, 2022. doi:10.1016/j.neuroimage.2022.119550.">7</a>]</span>) y FFClust (Fast Fiber Clustering, <span id="id8">[<a class="reference internal" href="References.html#id9" title="A. Vázquez, N. López-López, A. Sánchez, J. Houenou, C. Poupon, J. F. Mangin, C. Hernández, and P. Guevara. Ffclust: fast fiber clustering for large tractography datasets for a detailed study of brain connectivity. Neuroimage, 220:117070, 2020. doi:10.1016/j.neuroimage.2020.117070.">9</a>]</span>)</p>
<span class="target" id="module-phybers.clustering"></span><section id="hclust-description">
<h3>HClust Description<a class="headerlink" href="#hclust-description" title="Permalink to this heading"></a></h3>
<p>HClust is an average-link hierarchical agglomerative clustering algorithm which allows finding bundles based on a pairwise fiber distance measure.
The algorithm calculates a distance matrix between all fiber pairs for a bundles dataset (<span class="math notranslate nohighlight">\(d_{ij}\)</span>), by using the maximum of the Euclidean distance between fiber pairs (Equation [1]).
Then, it computes an affinity graph on the <span class="math notranslate nohighlight">\(d_{ij}\)</span> matrix for the fiber pairs that have Euclidean distance below a maximum distance threshold (<em>MaxDistance_Threshold</em>).
The Affinity <span id="id9">[<a class="reference internal" href="References.html#id11" title="L. J. O' Donnell and C. Westin. Automatic tractography segmentation using a high-dimensional white matter atlas. IEEE Transactions on Medical Imaging, 26(11):1562-75, 2007. doi:10.1109/TMI.2007.906785.">10</a>]</span> is given by the following equation:</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
a_{ij} = e^{\frac{-d_{ij}}{\sigma^{2}}}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(d_{ij}\)</span> is the distance between the elements <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, and <span class="math notranslate nohighlight">\(\sigma\)</span> is a parameter that defines the similarity scale in $mm$.</p>
<p>From the affinity graph, the hierarchical tree is generated using an agglomerative average-link hierarchical clustering algorithm.
The tree is adaptively partitioned using a distance threshold (<em>PartDistance_Threshold</em>).</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.clustering.hclust">
<span class="sig-prename descclassname"><span class="pre">phybers.clustering.</span></span><span class="sig-name descname"><span class="pre">hclust</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_out</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fiber_thr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_thr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/phybers/clustering/clustering.html#hclust"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.clustering.hclust" title="Permalink to this definition"></a></dt>
<dd><p>Average-link hierarchical agglomerative clustering algorithm which allows finding bundles based on a pairwise fiber distance measure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_in</strong> (<em>str</em>) – Tractography data file in <em>‘.bundles’</em> format.</p></li>
<li><p><strong>dir_out</strong> (<em>str</em>) – Directory to store all the results generated by the algorithm.</p></li>
<li><p><strong>fiber_thr</strong> (<em>str</em>) – Maximum distance threshold in <em>mm</em>, default: <em>30</em>.</p></li>
<li><p><strong>partition_thr</strong> (<em>str</em>) – Partition threshold in <em>mm</em>, default: <em>40</em>.</p></li>
<li><p><strong>variance</strong> (<em>str</em>) – Variance squared and provides a similarity scale in <em>mm</em>, default: <em>3600</em>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function generates the following files in the specified directory:</p>
<dl class="simple">
<dt>final_bundles<span class="classifier">bundles files</span></dt><dd><p>Directory that stores all the fiber clusters found in different ‘.bundles’ files.
The file names are labeled with integer numbers ranging from zero to the total number of fiber clusters found.</p>
</dd>
<dt>centroids<span class="classifier">bundles file</span></dt><dd><p>Directory that contains the centroid for each created cluster in same <em>‘.bundles’</em> files.
The firt fiber of bundle centroid is corresponding with centroid calculated for cluster one and so on</p>
</dd>
<dt>bundles_id<span class="classifier">text file</span></dt><dd><p>Text file that stores the fiber index input for each of the detected clusters.
The fiber indexes are extracted from the tractography input. The first line corresponds to cluster zero and so on.</p>
</dd>
<dt>outputs<span class="classifier">directory</span></dt><dd><p>Temporal directory with intermediate results</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test <cite>hclust()</cite>,  download the data from the <a class="reference external" href="https://www.dropbox.com/scl/fo/kei03zfjdlapltffdde1x/h?rlkey=03x2dw5m81jyno6vu8p5trjrw&amp;dl=1">link hclust</a>.
Then, open a Python terminal and run the following commands.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.clustering</span> <span class="kn">import</span> <span class="n">hclust</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hclust</span> <span class="p">(</span><span class="n">file_in</span> <span class="o">=</span> <span class="s1">&#39;fibers_test.bundles&#39;</span><span class="p">,</span> <span class="n">dir_out</span> <span class="o">=</span> <span class="s1">&#39;hclust_result&#39;</span><span class="p">,</span> <span class="n">fiber_thr</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">partition_thr</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">variance</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">)</span>
</pre></div>
</div>
<p>You will locate the clustering results in the ‘hclust_result’ directory.</p>
</dd></dl>

</section>
<section id="ffclust-description">
<h3>FFClust Description<a class="headerlink" href="#ffclust-description" title="Permalink to this heading"></a></h3>
<p>FFClust is an intra-subject clustering algorithm aims to identify compact and homogeneous fiber clusters on a large tractography dataset.
The algorithm consists of four stages. The stage 1 applies Minibatch K-Means clustering on five fiber points, and it merges fibers sharing the same point clusters (map clustering) in stage 2.
Next, it reassigns small clusters to bigger ones (stage 3) considering distance of fibers in direct and reverse order.
Finally, at stage 4, the algorithm groups clusters sharing the central point and merges close clusters represented by their centroids.
The distance among fibers is defined as the maximum of the Euclidean distance between corresponding points.</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.clustering.ffclust">
<span class="sig-prename descclassname"><span class="pre">phybers.clustering.</span></span><span class="sig-name descname"><span class="pre">ffclust</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_out</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><span class="m"><span class="pre">0</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">3</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">10</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">17</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">20</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><span class="m"><span class="pre">200</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">300</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">300</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">300</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="m"><span class="pre">200</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assign_thr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join_thr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">6</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/phybers/clustering/clustering.html#ffclust"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.clustering.ffclust" title="Permalink to this definition"></a></dt>
<dd><p>Intra-subject clustering algorithm aims to identify compact and homogeneous fiber clusters on a large tractography dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_in</strong> (<em>str</em>) – Tractography data file in <em>‘.bundles’</em> format.</p></li>
<li><p><strong>dir_out</strong> (<em>str</em>) – Directory to store all the results generated by the algorithm.</p></li>
<li><p><strong>points</strong> (<em>list</em><em>(</em><em>)</em>) – Index of the points to be used in the point clustering (K-means), default: 0, 3, 10, 17, 20.</p></li>
<li><p><strong>ks</strong> (<em>list</em><em>(</em><em>)</em>) – Number of clusters to be computed for each point using K-Means, default: 300, 200, 200, 200, 300.</p></li>
<li><p><strong>assign_thr</strong> (<em>str</em>) – Maximum distance threshold for the cluster reassignment in <em>mm</em>, default: <em>6</em>.</p></li>
<li><p><strong>join_thr</strong> (<em>str</em>) – Maximum distance threshold for the cluster merge in <em>mm</em>, default: <em>6</em>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function generates the following files in the specified directory:</p>
<dl class="simple">
<dt>final_bundles<span class="classifier">bundles files</span></dt><dd><p>Directory that stores all the fiber clusters found in different ‘.bundles’ files.
The file names are labeled with integer numbers ranging from zero to the total number of fiber clusters found.</p>
</dd>
<dt>centroids<span class="classifier">bundles file</span></dt><dd><p>Directory that contains the centroid for each created cluster in same <em>‘.bundles’</em> files.
The firt fiber of bundle centroid is corresponding with centroid calculated for cluster one an so on.</p>
</dd>
<dt>bundles_id<span class="classifier">text file</span></dt><dd><p>Text file that stores the fiber index input for each of the detected clusters. The fiber indexes are extracted from the tractography input.
The first line corresponds to cluster zero and so on.</p>
</dd>
<dt>outputs<span class="classifier">directory</span></dt><dd><p>Temporal directory with intermediate results</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test <cite>ffclust()</cite>,  download the data from the <a class="reference external" href="https://www.dropbox.com/sh/3z7uriisict4xxn/AADCsGDWEPeoHUVm4FqHzLdaa?dl=1">link ffclust</a> .
Then, open a Python terminal and run the following commands.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.clustering</span> <span class="kn">import</span> <span class="n">ffclust</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffclust</span> <span class="p">(</span><span class="n">file_in</span> <span class="o">=</span><span class="s1">&#39;fibers_test.bundles&#39;</span><span class="p">,</span> <span class="n">dir_out</span> <span class="o">=</span> <span class="s1">&#39;ffclust_result&#39;</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="n">ks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span> <span class="n">assign_thr</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">join_thr</span> <span class="o">=</span> <span class="mi">6</span> <span class="p">)</span>
</pre></div>
</div>
<p>You will locate the clustering results in the ‘ffclust_result’ directory.</p>
</dd></dl>

</section>
</section>
<section id="utils">
<span id="utils-doc"></span><h2>Utils<a class="headerlink" href="#utils" title="Permalink to this heading"></a></h2>
<p>The utils are a set of tools used for tractography preprocessing and the analysis of brain fiber clustering and segmentation results.
The module includes tools for reading and writing brain fiber files in <em>‘.bundles’</em> format, transform the fibers to a reference coordinate system based on a deformation field,
sampling of fibers at n equidistant points, calculation of intersection between sets of brain fibers,
and tools for extracting measures and filtering fiber clusters or segmented bundles.</p>
<span class="target" id="module-phybers.utils"></span><section id="deformation-description">
<h3>Deformation Description<a class="headerlink" href="#deformation-description" title="Permalink to this heading"></a></h3>
<p>The <em>deformation</em> sub-module transforms a tractography file to another space using a non-linear deformation file.
The maps must be stored in NIfTI format, where the voxels contain the transformation to be applied to each voxel 3D space location.
<em>deformation</em> applies the deformation to the 3D coordinates of the fiber points.
The <em>deformation</em> can be employed on HCP(Human Conectome Project) data during the preprocessing stage before applying the segmentation algorithm.</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.utils.deform">
<span class="sig-prename descclassname"><span class="pre">phybers.utils.</span></span><span class="sig-name descname"><span class="pre">deform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">deform_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_out</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/phybers/utils/utils.html#deform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.utils.deform" title="Permalink to this definition"></a></dt>
<dd><p>Transforms a tractography file to another space using a non-linear deformation image file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deform_file</strong> (<em>str</em>) – Deformation image (image in NIfTI format containing the deformations).</p></li>
<li><p><strong>file_in</strong> (<em>str</em>) – Input tractography dataset in bundles format.</p></li>
<li><p><strong>file_out</strong> (<em>str</em>) – Path to the transformed tractography dataset.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function generates the following files in the specified directory:</p>
<dl class="simple">
<dt>Tractography<span class="classifier">bundles file</span></dt><dd><p>Tractography dataset that has been transformed into the MNI space.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test <cite>deform()</cite>,  download the data from the <a class="reference external" href="https://www.dropbox.com/sh/ncu8sf1ifwz4wpv/AACDzOXEdSrf8kBaWrbjfEPla?dl=1">link deform</a>.
Then, open a Python terminal and run the following commands.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.utils</span> <span class="kn">import</span> <span class="n">deform</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deform</span><span class="p">(</span> <span class="n">deform_file</span> <span class="o">=</span> <span class="s1">&#39;defnolineal.nii&#39;</span><span class="p">,</span> <span class="n">file_in</span> <span class="o">=</span> <span class="s1">&#39;fibers.bundles&#39;</span><span class="p">,</span> <span class="n">file_out</span> <span class="o">=</span> <span class="s1">&#39;fibers_MNI.bundles&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note: Make sure to replace the file paths with the actual paths to your data and directories.</p>
</dd></dl>

</section>
<section id="sampling-description">
<h3>Sampling Description<a class="headerlink" href="#sampling-description" title="Permalink to this heading"></a></h3>
<p>The <em>sampling</em> sub-module performs a sampling of the fibers, recalculating their points using a defined number of equidistant points.
The sampling sub-module is used in the preprocessing stage of the segmentation and clustering algorithms.</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.utils.sampling">
<span class="sig-prename descclassname"><span class="pre">phybers.utils.</span></span><span class="sig-name descname"><span class="pre">sampling</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_out</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npoints</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">21</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/phybers/utils/utils.html#sampling"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.utils.sampling" title="Permalink to this definition"></a></dt>
<dd><p>Performs a fiber sampling by recalculating their points using a specified number of equidistant points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_in</strong> (<em>str</em>) – Tractography dataset file in <em>‘.bundles’</em> format.</p></li>
<li><p><strong>file_out</strong> (<em>str</em>) – Path to save the sub-sampled fibers.</p></li>
<li><p><strong>atlas_dir</strong> (<em>str</em>) – Bundle atlas, with bundles in separated files, sampled at 21 equidistant points. The bundle atlases provided are in same folders.</p></li>
<li><p><strong>npoints</strong> (<em>str</em>) – number of sampling points (n). Default: <em>21</em>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function generates the following files in the specified directory:</p>
<dl class="simple">
<dt>Tractography<span class="classifier">bundles file</span></dt><dd><p>Tractography dataset sampled at n equidistant points.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test <cite>sampling()</cite>,  download the data from the <a class="reference external" href="https://www.dropbox.com/sh/9tfxseo8uh68b32/AAAn56Xgiw7KhL2ILmkN6A23a?dl=1">link sampling</a>.
Then, open a Python terminal and run the following commands.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.utils</span> <span class="kn">import</span> <span class="n">sampling</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sampling</span> <span class="p">(</span> <span class="n">file_in</span> <span class="o">=</span> <span class="s1">&#39;sub_01.bundles&#39;</span><span class="p">,</span> <span class="n">file_out</span> <span class="o">=</span> <span class="s1">&#39;sub_01_21points.bundles&#39;</span><span class="p">,</span> <span class="n">npoints</span> <span class="o">=</span> <span class="mi">21</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note: Make sure to replace the file paths with the actual paths to your data and directories.</p>
</dd></dl>

</section>
<section id="intersection-description">
<h3>Intersection Description<a class="headerlink" href="#intersection-description" title="Permalink to this heading"></a></h3>
<p>The <em>bundle intersection</em> sub-module calculates a similarity measure between two sets of brain fibers (fiber clusters or segmented bundles).
It uses a maximum distance threshold to consider two fibers as similar. Both sets of fibers must be in the same space.
First, a Euclidean distance matrix is calculated between the fibers of the two sets.
Then, the maximum distance threshold is applied between fiber pairs and the number of fibers from one set that have a similar fibers in the other set are count, for both sets.
The similarity measure yields a value between <em>0</em> and <em>100%</em>.</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.utils.intersection">
<span class="sig-prename descclassname"><span class="pre">phybers.utils.</span></span><span class="sig-name descname"><span class="pre">intersection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file1_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file2_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_out</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_thr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/phybers/utils/utils.html#intersection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.utils.intersection" title="Permalink to this definition"></a></dt>
<dd><p>Calculates a similarity measure between two sets of brain fibers (fiber clusters or segmented bundles).
The similarity measure yields a value between <em>0</em> and <em>100%</em>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file1_in</strong> (<em>str</em>) – Path of the first fiber bundle.</p></li>
<li><p><strong>file2_in</strong> (<em>str</em>) – Path of the second fiber bundle.</p></li>
<li><p><strong>dir_out</strong> (<em>str</em>) – Path to save the distance matrix</p></li>
<li><p><strong>distance_thr</strong> (<em>float</em>) – Distance threshold in millimeters used to consider similar two fibers, default: <em>10</em>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Tuple</strong> – <cite>[float, float]</cite>, The first value indicates the percentage of intersection of the first set of fibers compared to the second set of fibers,
and the second value indicates the reverse scenario, intersection of the second set of fibers compared to the first set of fibers.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[float, float]</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test <cite>intersection()</cite>, download the data from the <a class="reference external" href="https://www.dropbox.com/scl/fo/vs55r9ji7k0s5svci95qx/h?rlkey=1bl1mo85uc6x2wftc8yr1zfyq&amp;dl=1">link intersection</a>.
The provided data is identical, therefore a <em>100%</em> intersection is expected.
Then, open a Python terminal and run the following commands.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.utils</span> <span class="kn">import</span> <span class="n">intersection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result_inter</span><span class="o">=</span><span class="n">intersection</span> <span class="p">(</span> <span class="n">file1_in</span> <span class="o">=</span> <span class="s1">&#39;fib1.bundles&#39;</span><span class="p">,</span> <span class="n">file2_in</span> <span class="o">=</span> <span class="s1">&#39;fib2.bundles&#39;</span><span class="p">,</span> <span class="n">dir_out</span> <span class="o">=</span> <span class="s1">&#39;inter_result&#39;</span><span class="p">,</span> <span class="n">distance_thr</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; intersection fibers1 with fibers2 &#39;</span><span class="p">,</span> <span class="n">result_inter</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; intersection fibers2 with fibers1 &#39;</span><span class="p">,</span> <span class="n">result_inter</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note: Make sure to replace the file paths with the actual paths to your data and directories.</p>
</dd></dl>

</section>
<section id="postprocessing-description">
<h3>Postprocessing Description<a class="headerlink" href="#postprocessing-description" title="Permalink to this heading"></a></h3>
<p>The <em>Postprocessing</em> sub-module contains a set of algorithms that can be applied on the results of clustering and segmentation algorithms.
This algorithm constructs a <cite>pandas.DataFrame object</cite> , where each key corresponds to the name of the fiber set (cluster or segmented fascicle),
followed by measures defined on the fiber set such as: size (number of fibers), intra-set distance and mean length (in <em>mm</em>).
It can be used to perform single or multiple feature filtering on the clustering or segmentation results.</p>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.utils.postprocessing">
<span class="sig-prename descclassname"><span class="pre">phybers.utils.</span></span><span class="sig-name descname"><span class="pre">postprocessing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_in</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="_modules/phybers/utils/utils.html#postprocessing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phybers.utils.postprocessing" title="Permalink to this definition"></a></dt>
<dd><p>Sets of algorithms that can be applied on the results of clustering and segmentation algorithms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dir_in</strong> (<em>str</em>) – Root directory where all segmentation or clustering algorithm results are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><cite>pd.DataFrame</cite>, contains the following list of keys: ‘id_bundle’: bundle identifier, ‘sizes’: number of fibers in the bundle,
‘lens’: centroid length per bundle, ‘intra_min’: manimum intra-bundle Euclidean distance and intra_mean’: mean intra-bundle Euclidean distance.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test postprocessing(), download the data from the provided link, or execute it on the results of a clustering or segmentation algorithm.
Then, open a Python terminal and run the following commands.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.utils</span> <span class="kn">import</span> <span class="n">postprocessing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">postprocessing</span> <span class="p">(</span> <span class="n">dir_in</span> <span class="o">=</span> <span class="nb">str</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note: Make sure to replace the file paths with the actual paths to your data and directories.</p>
</dd></dl>

</section>
</section>
<section id="visualization">
<span id="visualization-doc"></span><h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this heading"></a></h2>
<p>The tractography files can be rendered with lines or cilynders.
In the case of lines, the software loads the streamlines with a fixed normal per vertex, which correspond to the normalized direction for the particular segment of the streamline.
Furthermore, a phong lighting algorithm <span id="id10">[<a class="reference internal" href="References.html#id5" title="I. Osorio, M. Guevara, D. Bonometti, D. Carrasco, M. Descoteaux, C. Poupon, J. F. Mangin, C. Hernández, and P. Guevara. Abrainvis: an android brain image visualization tool. Biomed Eng Online, 20(1):72, 2021. doi:10.1186/s12938-021-00909-0.">11</a>]</span> is implemented in a vertex shader to compute the color fetched for the streamline.
The MRI data is rendered by using specific shaders for slice visualization and volume rendering. Meshes can be displayed using points, wireframes or shaded triangles.
The user interface (GUI) allows viewing several objects simultaneously, performing camera operations (zoom, rotate and pan), modifying material properties (color and adding transparency)
and applying linear transformation on the brain tractography.</p>
<blockquote>
<div><span class="target" id="module-phybers.fibervis"></span></div></blockquote>
<ul class="simple">
<li><p>Fiber selection based on 3D ROIs
This function allows users to extract bundles using 3D objects and labeled 3D images, creating a point-based data structure for fast queries (called Octree).
It is based on storing points inside a bounding box with a capacity of N. When a node is filled and a new point is added,
the node subdivides his bounding box in eight new nodes (no overlapping each other) and the points are moved in the new nodes.
The resulting selected fiber for each object can be used into logical mathematical operations (and, or, xor, not).
This allows the use of multiple ROIs in order to find fibers that connect some areas, while excluding others that are selected by others areas.</p></li>
</ul>
<dl class="py function">
<dt class="sig sig-object py" id="phybers.fibervis.start_fibervis">
<span class="sig-prename descclassname"><span class="pre">phybers.fibervis.</span></span><span class="sig-name descname"><span class="pre">start_fibervis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bundles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mri</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mesh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phybers.fibervis.start_fibervis" title="Permalink to this definition"></a></dt>
<dd><p>Initializes the graphical user interface (GUI).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To test <cite>fibervis()</cite>, download the data from the links provided above. Then, open a Python terminal and run the following commands:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">phybers.fibervis</span> <span class="kn">import</span> <span class="n">start_fibervis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_fibervis</span><span class="p">()</span>
</pre></div>
</div>
<p><cite>fibervis()</cite> is installed as a program, allowing you to run it through the command line in Windows or Ubuntu. To execute it on both platforms, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>fibervis
</pre></div>
</div>
<p>For your convenience in using <cite>fibervis()</cite>, we are currently working on a comprehensive video that showcases all its features.
The video is under construction, and you’ll be able to access it through the following link: [Video build].</p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Examples%20and%20Tutorial%20Guide.html" class="btn btn-neutral float-left" title="Examples and Tutorial Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="References.html" class="btn btn-neutral float-right" title="References" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, L.Liset González Rodríguez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>